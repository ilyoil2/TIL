# 헥사고날 아키텍쳐

## 헥사고날 패턴을 사용하는 이유

- 애플리케이션은 데이터베이스에 있는 데이터를 그저 옮겨주는 수동적인 소프트웨어를 넘어 보다 적극적이고, 여러 일을 할 수 있어야한다.
- 데이터베이스 같은 외부 시스템이 애플리케이션의 중심이 아니라, 애플리케이션이 “사용하는” 일부가 되어야 한다.
- 상황에 따라 RDBMS에서 NoSQL을 쓸 수도 있고, API 서버와 통신 방식을 Rest에서 GraphQL로 바꿀 수 있어야 한다.

애플리케이션을 중심으로 보고, DB, 웹 프레임워크 등은 모두 애플리케이션이 사용하는 부품(언제든 갈아끼울 수 있는)으로 보는 아키텍처들이 주목받기 시작했다.

대표적인 아키텍처로 헥사고날 아키텍처와 클린 아키텍처가 있다.

---

## 2. 개념

- 가운데 애플리케이션을 중심으로 애플리케이션 외의 모듈은 애플리케이션에서 제공하는 포트 모양에 맞다면 언제든 바꿀 수 있도록 하는 것이다.
- 헥사고날 아키텍처는 어댑터가 포트 모양만 맞으면 동작하는 것 같다고 해서 포트 앤 어댑터(Ports-and-Adapters)라고 부르기도 한다.
- 즉 포트만 맞으면, 어떤 어댑터든 이 포트에 끼울 수 있다.

- 도메인 비즈니스 로직이 외부요소에 의존하지 않게 만들고, 프레젠테이션 계층(controller)과 데이터 소스 계층(persistence) 같은 외부 요소들이 도메인 계층에 의존하도록 한다.
    
    
    → 모듈을 두 개로 만들어서 도메인과 인프라를 철저하게 구분한다. 
    
    application에는 핵심 비지니스 로직을 두고 infrastructure 에는 외부와의 상호작용을 처리한다
    
    이렇게 하면 application이 필요 없는 dependencies를 infra 에서만 사용할 수 있고, orm을 변경해도 도메인에 영향을 끼치지 않는다.
    
    → 외부와의 접촉을 인터페이스로 추상화하여 비즈니스 로직 안에 외부 코드나 로직의 주입을 막는 것, 외부 라이브러리 및 툴로부터 분리시키는 것이 아키텍처의 핵심이다. = 인터페이스를 사이사이 둔다.
    

## 3. 구조

![202562088-c1125e16-049a-45dc-864b-31740d7a93a4.png](%E1%84%92%E1%85%A6%E1%86%A8%E1%84%89%E1%85%A1%E1%84%80%E1%85%A9%E1%84%82%E1%85%A1%E1%86%AF%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A7%2095fade13ddda459ab5b6f8c9bcdc21f5/202562088-c1125e16-049a-45dc-864b-31740d7a93a4.png)

1. 내부 포트(Internal Ports): 내부 포트는 애플리케이션의 핵심 비즈니스 로직이 위치한 부분입니다. 이 내부 포트는 비즈니스 로직을 실행하고 외부로 데이터를 노출하지 않으며 외부에 독립적으로 존재합니다.
2. 외부 포트(External Ports): 외부 포트는 애플리케이션과 외부 환경(예: 데이터베이스, 웹 API, 메시지 큐 등) 간의 상호 작용을 담당합니다. 외부 포트는 내부 포트를 통해 호출되며, 외부 시스템과의 통합을 담당합니다.
3. 어댑터(Adapter): 어댑터는 외부 포트와 내부 포트를 연결하는 역할을 합니다. 이 어댑터는 외부 시스템과의 통신을 처리하고 내부 포트로 요청을 전달하거나 응답을 처리합니다.
4. 엔티티(Entity): 엔티티는 애플리케이션의 핵심 비즈니스 데이터를 표현하며, 내부 포트에서 사용됩니다. 엔티티는 업무 도메인의 핵심 객체를 나타내며, 비즈니스 규칙을 캡슐화합니다.

---

- User 와 UserEntity로 나누는 이유는?

User은 도메인으로서 순수하게 필드만 있어야 한다.

UserEntity는 infrastruct에 있는 엔티티로 서버에 올라갈 필드의 유효성을 검사해야하기 때문에 여러 제약조건을 넣는다

- UserPersistenceAdapter 와 UserWebAdapter의 차이는 ?

UserWebAdapter는 UserController 와 같은 역할로서, usercase와 연결을 해주고,

UserPersistenceAdapter는 application에 있는 UserPort, 그니까 UserRepository의 기능들을 @Override하여 infastructure 에서도 사용할 수 있게 해주려고 하기 때문이다.